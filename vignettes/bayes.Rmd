---
title: "Bayes test"
author: "Xavier Didelot"
date: '`r Sys.Date()`'
output:
  pdf_document: default
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Sensitivity tests}
  %\usepackage[utf8]{inputenc}
---

In this vignette we demonstrate the Bayesian test by simulating with imports.

# Initialisation

```{r}
library(DetectImports)
library(ape)
set.seed(0)
```

# Simulation with a single import

Let's consider that the local population started in 2020 and a single import occurred in 2020.5.
1000 genomes were sampled between 2020 and 2021.

```{r}
tree=simImports(localPopStart=2020,importDates=c(2020.5),
                samplingStartDate=2020,samplingEndDate=2021,samplingNumber=1000)
plot(tree,show.tip.label = F)
axisPhylo(backward = F)
```

Let's detect the imports:

```{r}
pvals=testBayes(tree)
```

The real imports were:
```{r}
tree$imports
```

The inferred imports were:
```{r}
which(pvals<0.05)
```

# Simulation with two imports

Let's consider that the local population started in 2020 and two imports occurred in 2020.33 and 2020.66.
1000 genomes were sampled between 2020 and 2021.

```{r}
set.seed(0)
tree=simImports(localPopStart=2020,importDates=c(2020.33,2020.66),
                samplingStartDate=2020,samplingEndDate=2021,samplingNumber=1000)
plot(tree,show.tip.label = F)
axisPhylo(backward = F)
```

Let's detect the imports:

```{r}
pvals=testBayes(tree)
```

The real imports were:
```{r}
tree$imports
plotImports(tree,tree$imports)
```

The inferred imports were:
```{r}
which(pvals<0.05)
plotImports(tree,which(pvals<0.05))
```
